rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * FIREBASE SECURITY RULES
     * 
     * Fokus: Mengizinkan publik untuk melihat jumlah aspirasi (list) 
     * namun tetap membatasi pengelolaan hanya untuk Admin.
     */

    // --- Fungsi Pembantu ---

    function isSignedIn() {
      return request.auth != null;
    }

    // Untuk prototipe ini, kita anggap pengguna yang masuk adalah admin
    // Di produksi, gunakan pengecekan koleksi admin_roles
    function isAdmin() {
      return isSignedIn();
    }

    // --- Aturan Koleksi ---

    match /admin_roles/{adminUid} {
      allow read, write: if isAdmin();
    }

    match /aspirations/{submissionCode} {
      // Mengizinkan publik untuk list (untuk counter di homepage) 
      // dan get (untuk tracking status)
      allow get, list: if true;
      allow create: if request.resource.data.submissionCode == submissionCode;
      allow update, delete: if isAdmin();
    }

    match /events/{eventId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }

    match /programs/{programId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }

    match /members/{memberId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }

    match /articles/{articleId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }

    match /gallery_images/{imageId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }
  }
}